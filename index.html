<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sendFile2Disco</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="referrer" content="no-referrer" />
	<meta http-equiv="refresh" content="300">
	<link rel="stylesheet" href="https://n138-kz.github.io/lib/master.css?t=0">
	<script src="https://n138-kz.github.io/lib/master.js"></script>
	<script>
		init_setTopMaker();
		init_setFavicon('https://www.google.com/s2/favicons?size=64&domain='+'https://discord.com');
		init_setHeaderText();
	</script>
	<script>
		if (!!location.protocol.match(/https?:/) && location.origin!='https://n138-kz.github.io') {
			location.replace('https://n138-kz.github.io/sendFile2Discos/');
		}
	</script>
	<script>
        async function getGithubRepos(repos=null) {
            let url='https://api.github.com/repos/';
            if (repos===null) { repos=''; }
            url += repos;

            const response = await fetch(url);
            const json = await response.json();
            return await json;
        }
        async function getIPaddress() {
            let url='https://api.n138.jp/isJP/';

            const response = await fetch(url);
            const json = await response.json();
            return await json.result.request;
        }
        async function getConfig(path='config.json') {
            let url=location.origin+location.pathname+path;

            const response = await fetch(url);
            const json = await response.json();
            return await json;
        }
        window.addEventListener('DOMContentLoaded', async ()=>{
            let domitem=[];
            const github_repos=await getGithubRepos('n138-kz/sendFile2Disco');
            const remote_addr=await getIPaddress();
            const loaded_config=await getConfig();
            domitem[0]=document.createElement('a');
            domitem[0].href=`https://ipinfo.io/${remote_addr.request}`;
            domitem[0].innerText=`${remote_addr.detail}`;
            document.querySelector('#remote_address_print').appendChild(domitem[0]);
            let wh_endpoint=loaded_config.external.discord.webhooks[0].url;
            console.log(wh_endpoint);
            
            document.querySelector('#sendFile2Discos_main').action=wh_endpoint;
		});
	</script>
</head>
<body>
    <form action="" method="POST" accept="multipart/form-data" id="sendFile2Discos_main">
        <table>
            <thead>
                <input type="hidden" name="remote_address" id="remote_address" />
                <tr>
                    <th></th>
                    <td><span id="remote_address_print"></span></td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>Files</th>
                    <td>
                        <input type="file" name="files[]" id="files" multiple>
                    </td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>
                        <input type="text" name="content" id="content" required>
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td>
                        <input type="submit" value="Submit">
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</body>
</html>
